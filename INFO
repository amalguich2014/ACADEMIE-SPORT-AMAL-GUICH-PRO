<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© | Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø£Ù…Ù„ ÙƒÙŠØ´</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=Changa:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- âœ… Ø¥Ø¶Ø§ÙØ© ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø£ÙŠ Ù…Ø¹Ø·ÙŠØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù -->
    <link rel="stylesheet" href="assets/css/pro-theme.css">

    <style>
        :root {
            --primary: #0f172a;
            --secondary: #2563eb;
            --accent: #fbbf24;
            --danger: #ef4444;
            --success: #22c55e;
            --sidebar-width: 280px;
            --bg-body: radial-gradient(circle at top left, #1e293b, #0f172a);
            --card-bg: rgba(30, 41, 59, 0.7);
            --header-bg: rgba(30, 41, 59, 0.5);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border-alpha: rgba(255, 255, 255, 0.1);
            --btn-bg: linear-gradient(145deg, #1e293b, #0f172a);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        [data-theme="light"] {
            --bg-body: radial-gradient(circle at top left, #f8fafc, #e2e8f0);
            --card-bg: rgba(255, 255, 255, 0.9);
            --header-bg: rgba(255, 255, 255, 0.8);
            --text-main: #0f172a;
            --text-muted: #475569;
            --border-alpha: rgba(15, 23, 42, 0.1);
            --btn-bg: #ffffff;
        }
        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body { font-family: 'Cairo', sans-serif; background: var(--bg-body); background-attachment: fixed; margin: 0; display: flex; color: var(--text-main); min-height: 100vh; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--secondary); border-radius: 10px; }
        .glass-card { background: var(--card-bg); backdrop-filter: blur(12px); padding: 25px; border-radius: 24px; border: 1px solid var(--border-alpha); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 10px; }
        th { text-align: right; padding: 15px 20px; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; }
        html[dir="ltr"] th { text-align: left; }
        td { padding: 15px 20px; background: rgba(255, 255, 255, 0.03); border: none; }
        [data-theme="light"] td { background: rgba(0, 0, 0, 0.02); }
        td:first-child { border-radius: 0 15px 15px 0; }
        td:last-child { border-radius: 15px 0 0 15px; }
        html[dir="ltr"] td:first-child { border-radius: 15px 0 0 15px; }
        html[dir="ltr"] td:last-child { border-radius: 0 15px 15px 0; }
        tr:hover td { background: rgba(37, 99, 235, 0.1); transform: scale(1.005); }
        .status-badge { padding: 6px 14px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; }
        .btn { border: none; border-radius: 10px; cursor: pointer; font-family: 'Cairo'; font-weight: 600; padding: 8px 16px; display: inline-flex; align-items: center; gap: 8px; }
        .btn:active { transform: scale(0.95); }
        .mode-toggle { position: fixed; top: 25px; left: 25px; z-index: 1100; width: 50px; height: 50px; border-radius: 16px; background: var(--secondary); color: white; border: none; cursor: pointer; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3); }
        .lang-toggle { position: fixed; top: 25px; left: 85px; z-index: 1100; display: flex; gap: 5px; }
        .lang-btn { background: var(--card-bg); color: var(--text-main); border: 1px solid var(--border-alpha); padding: 10px 15px; border-radius: 12px; cursor: pointer; font-weight: bold; font-family: 'Changa'; }
        nav { width: var(--sidebar-width); background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); border-left: 1px solid var(--border-alpha); border-right: 1px solid var(--border-alpha); color: white; height: 100vh; position: fixed; display: flex; flex-direction: column; padding: 0 20px 20px; z-index: 1000; }
        .academy-identity-box { padding: 30px 10px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        #mainLogo { width: 90px; height: 90px; border-radius: 22px; object-fit: cover; border: 3px solid var(--secondary); padding: 5px; background: white; margin-bottom: 15px; }
        #mainName { font-family: 'Changa', sans-serif; font-size: 1.2rem; font-weight: 800; color: #fff; margin: 0; }
        nav ul { list-style: none; padding: 0; flex: 1; overflow-y: auto; }
        nav ul li a { color: #94a3b8; text-decoration: none; display: flex; align-items: center; padding: 14px 18px; border-radius: 16px; margin-bottom: 8px; font-weight: 600; }
        nav ul li a i { width: 25px; font-size: 1.1rem; }
        nav ul li a:hover, nav ul li a.active { background: linear-gradient(90deg, var(--secondary), #3b82f6); color: white; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
        main { flex: 1; margin-right: var(--sidebar-width); padding: 40px; max-width: calc(100vw - var(--sidebar-width)); }
        html[dir="ltr"] main { margin-right: 0; margin-left: var(--sidebar-width); }
        html[dir="ltr"] nav { left: 0; right: auto; }
        html[dir="rtl"] nav { right: 0; left: auto; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; background: var(--header-bg); backdrop-filter: blur(10px); padding: 20px 30px; border-radius: 24px; border: 1px solid var(--border-alpha); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 24px; border: 1px solid var(--border-alpha); position: relative; overflow: hidden; }
        .stat-card:hover { transform: translateY(-8px); border-color: var(--secondary); }
        .stat-card .info h4 { margin: 0; color: var(--text-muted); font-size: 0.85rem; font-weight: 600; }
        .stat-card .info span { font-family: 'Changa', sans-serif; color: var(--text-main); font-size: 1.8rem; font-weight: 800; display: block; margin-top: 5px; }
        .stat-card i { position: absolute; left: -10px; bottom: -10px; font-size: 4rem; opacity: 0.08; color: var(--secondary); transform: rotate(-15deg); }
        .quick-title { font-size: 1.3rem; margin: 40px 0 25px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 12px; }
        .quick-title::after { content: ''; flex: 1; height: 1px; background: var(--border-alpha); }
        .quick-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; }
        .quick-btn { background: var(--card-bg); padding: 25px 15px; border-radius: 22px; text-decoration: none; color: var(--text-main); text-align: center; border: 1px solid var(--border-alpha); display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .quick-btn i { width: 60px; height: 60px; background: rgba(37, 99, 235, 0.1); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; color: var(--secondary); }
        .quick-btn:hover { background: var(--secondary); color: white !important; transform: scale(1.05); box-shadow: 0 15px 30px rgba(37, 99, 235, 0.2); }
        .quick-btn:hover i { background: white; color: var(--secondary); }
        .player-img-mini { width: 45px; height: 45px; border-radius: 12px; object-fit: cover; border: 2px solid var(--secondary); }
        @media (max-width: 992px) { nav { width: 85px; padding: 15px 10px; } .identity-details, #mainName, nav ul li a span, .academy-identity-box h1, .academy-identity-box div { display: none; } #mainLogo { width: 55px; height: 55px; margin-bottom: 0; } main { margin-right: 85px; padding: 20px; } html[dir="ltr"] main { margin-left: 85px; margin-right: 0; } .header-top { flex-direction: column; text-align: center; gap: 15px; } }
    </style>
</head>
<body data-theme="dark">
    <button class="mode-toggle" id="themeBtn" onclick="toggleMode()">
        <i class="fas fa-sun" id="themeIcon"></i>
    </button>
    <div class="lang-toggle">
        <button onclick="changeLanguage('ar')" class="lang-btn">AR</button>
        <button onclick="changeLanguage('fr')" class="lang-btn">FR</button>
    </div>
    <nav>
        <div class="academy-identity-box">
            <img id="mainLogo" src="" alt="Ù„ÙˆØ¬Ùˆ" style="display: none;">
            <i id="defaultIcon" class="fas fa-futbol fa-3x" style="color: white; margin-bottom: 10px;"></i>
            <h1 id="mainName">ØªØ­Ù…ÙŠÙ„...</h1>
            <div class="identity-details">
                <span id="mainPhone"></span>
                <span id="mainEmail"></span>
                <span id="mainAddress"></span>
            </div>
        </div>
        <ul id="sidebarMenu">
            <li><a href="index.html" class="active"><i class="fas fa-th-large"></i> <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a></li>
            <li><a href="pages/adm_players.html"><i class="fas fa-users"></i> <span>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</span></a></li>
            <li><a href="pages/registration.html"><i class="fas fa-user-clock"></i> <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø®Ø±Ø§Ø·</span></a></li>
            <li><a href="pages/coaches.html"><i class="fas fa-chalkboard-teacher"></i> <span>Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</span></a></li>
            <li><a href="pages/schedule.html"><i class="fas fa-calendar-alt"></i> <span>Ø§Ù„Ø¬Ø¯ÙˆÙ„</span></a></li>
            <li><a href="pages/fournisseur.html"><i class="fas fa-handshake"></i> <span>Ø§Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†</span></a></li>
            <li><a href="pages/contracts.html"><i class="fas fa-file-signature"></i> <span>Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø´Ø±Ø§ÙƒØ©</span></a></li>
            <li><a href="pages/adm-finance.html"><i class="fas fa-wallet"></i> <span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></a></li>
            <li><a href="pages/insurance.html"><i class="fas fa-user-shield"></i> <span>Ø§Ù„ØªØ£Ù…ÙŠÙ†</span></a></li>
            <li><a href="pages/uniforms.html"><i class="fas fa-tshirt"></i> <span>Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</span></a></li>
            <li><a href="pages/adm_pro.html"><i class="fas fa-star"></i> <span>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</span></a></li>
            <li><a href="pages/adml-statistics.html"><i class="fas fa-chart-line"></i> <span>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span></a></li>
            <li><a href="pages/parametre.html"><i class="fas fa-cogs"></i> <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a></li>
        </ul>
    </nav>
    <main>
        <div class="header-top">
            <div class="welcome-text">
                <h2 id="welcomeMsg" style="font-weight: 800;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ğŸ‘‹</h2>
                <p id="currentDate" style="font-weight: 600;"></p>
            </div>
            <div class="user-profile">
                <img src="https://ui-avatars.com/api/?name=Admin&background=2563eb&color=fff" style="border-radius: 15px; width: 55px; border: 3px solid var(--secondary); box-shadow: var(--shadow-sm);">
            </div>
        </div>

        <section class="stats-grid">
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h4><span id="playerCount">0</span></div>
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</h4><span id="coachCount">0</span></div>
                <i class="fas fa-user-tie"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h4><span id="totalRequests">0</span></div>
                <i class="fas fa-user-clock"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ù…Ù„Ø®Øµ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±</h4><span id="monthlyProfit" style="color: var(--success);">0.00 DH</span></div>
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ù…Ù„Ø®Øµ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø³Ù†Ø©</h4><span id="yearlyProfit" style="color: var(--accent);">0.00 DH</span></div>
                <i class="fas fa-gem"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</h4><span id="netProfit" style="color: var(--success);">0.00 DH</span></div>
                <i class="fas fa-balance-scale"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h4><span id="monthlyExpenses" style="color: var(--danger);">0.00 DH</span></div>
                <i class="fas fa-arrow-down"></i>
            </div>
            <div class="stat-card">
                <div class="info"><h4 class="stat-label">Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h4><span id="totalDebtDisplay" style="color: var(--danger);">0.00 DH</span></div>
                <i class="fas fa-shopping-cart"></i>
            </div>
        </section>

        <div class="glass-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h2 id="tableTitle" style="font-family: 'Changa'; color: var(--secondary); margin: 0; font-weight: 800;">
                    <i class="fas fa-bell"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø®Ø±Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±Ø© 
                </h2>
                <span id="requestCountBadge" class="status-badge" style="background: var(--secondary); color: white;">0 Ø·Ù„Ø¨Ø§Øª</span>
            </div>
            <div style="overflow-x: auto;">
                <table id="mainDataTable">
                    <thead>
                        <tr>
                            <th class="t-col">Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th class="t-col">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                            <th class="t-col">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯</th>
                            <th class="t-col">Ø§Ù„ÙØ¦Ø©</th>
                            <th class="t-col">Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                            <th class="t-col">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="registrationsTable"></tbody>
                </table>
            </div>
        </div>

        <span id="quickAccessTitle" class="quick-title">Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ù‡Ø§Ù…</span>
        <section class="quick-grid" id="quickGrid">
            <a href="pages/adm_players.html" class="quick-btn"><i class="fas fa-user-plus"></i><span class="q-span">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</span></a>
            <a href="pages/coaches.html" class="quick-btn"><i class="fas fa-chalkboard-teacher"></i><span class="q-span">Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</span></a>
            <a href="pages/contact.html" class="quick-btn"><i class="fas fa-address-book"></i><span class="q-span">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†ÙˆØ§Ø¯ÙŠ</span></a>
            <a href="pages/contracts.html" class="quick-btn"><i class="fas fa-file-signature"></i><span class="q-span"> Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø´Ø±Ø§ÙƒØ© ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</span></a>
            <a href="pages/adm-finance.html" class="quick-btn"><i class="fas fa-file-invoice-dollar"></i><span class="q-span">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></a>
            <a href="pages/registration.html" class="quick-btn"><i class="fas fa-clipboard-list"></i><span class="q-span">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª</span></a>
            <a href="pages/adml-statistics.html" class="quick-btn"><i class="fas fa-chart-pie"></i><span class="q-span">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span></a>
            <a href="pages/schedule.html" class="quick-btn"><i class="fas fa-calendar-check"></i><span class="q-span">Ø§Ù„Ø¬Ø¯ÙˆÙ„</span></a>
            <a href="pages/adm_pro.html" class="quick-btn"><i class="fas fa-star"></i><span class="q-span">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span></a>
            <a href="pages/adm_parametre.html" class="quick-btn"><i class="fas fa-sliders-h"></i><span class="q-span">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></a>
        </section>
    </main>

    <script>
        const translations = {
            ar: { welcome: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ğŸ‘‹", nav: ["Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", "Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†", "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø®Ø±Ø§Ø·", "Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†", "Ø§Ù„Ø¬Ø¯ÙˆÙ„", "Ø§Ù„Ù…Ø²ÙˆØ¯ÙŠÙ†", "Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø´Ø±Ø§ÙƒØ©", "Ø§Ù„Ù…Ø§Ù„ÙŠØ©", "Ø§Ù„ØªØ£Ù…ÙŠÙ†", "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©", "Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„", "Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"], statLabels: ["Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†", "Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†", "Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©", "Ù…Ù„Ø®Øµ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±", "Ù…Ù„Ø®Øµ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø³Ù†Ø©", "ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­", "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª", "Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"], tableTitle: "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø®Ø±Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±Ø©", quickTitle: "Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ù‡Ø§Ù…", quickBtns: ["Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†", "Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†", "Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†ÙˆØ§Ø¯ÙŠ", "Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø´Ø±Ø§ÙƒØ©", "Ø§Ù„Ù…Ø§Ù„ÙŠØ©", "Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª", "Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", "Ø§Ù„Ø¬Ø¯ÙˆÙ„", "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª", "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"], th: ["Ø§Ù„ØµÙˆØ±Ø©", "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø²Ø¯ÙŠØ§Ø¯", "Ø§Ù„ÙØ¦Ø©", "Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±", "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"], btnApprove: "Ù‚Ø¨ÙˆÙ„", noRequests: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹", reqBadge: "Ø·Ù„Ø¨Ø§Øª", confirmApprove: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ù†Ù‚Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©ØŸ", confirmDelete: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ", dateLocale: "ar-MA", dir: "rtl" },
            fr: { welcome: "Bienvenue Ã  l'Administration Centrale ğŸ‘‹", nav: ["Accueil", "Joueurs", "Inscriptions", "EntraÃ®neurs", "Calendrier", "Fournisseurs", "Contrats", "Finance", "Assurance", "Ã‰quipements", "Portail Pro", "Statistiques", "ParamÃ¨tres"], statLabels: ["Total Joueurs", "EntraÃ®neurs", "Nouv. Demandes", "BÃ©nÃ©fice Mensuel", "BÃ©nÃ©fice Annuel", "BÃ©nÃ©fice Net", "DÃ©penses Mensuelles", "Dettes Achats"], tableTitle: "DerniÃ¨res Inscriptions", quickTitle: "AccÃ¨s Rapide aux TÃ¢ches", quickBtns: ["Gestion Joueurs", "EntraÃ®neurs", "Annuaire Clubs", "Contrats", "Finance", "Formulaires", "Statistiques", "Calendrier", "Ã‰valuations", "ParamÃ¨tres"], th: ["Photo", "Nom Complet", "Date Naissance", "CatÃ©gorie", "Parent TÃ©l", "Actions"], btnApprove: "Accepter", noRequests: "Aucune demande pour le moment", reqBadge: "Demandes", confirmApprove: "Voulez-vous transfÃ©rer ce joueur Ã  la liste officielle?", confirmDelete: "ÃŠtes-vous sÃ»r de vouloir supprimer dÃ©finitivement cette demande?", dateLocale: "fr-FR", dir: "ltr" }
        };

        function changeLanguage(lang) {
            const t = translations[lang];
            document.documentElement.dir = t.dir;
            document.documentElement.lang = lang;
            localStorage.setItem('pref-lang', lang);
            document.getElementById('welcomeMsg').innerText = t.welcome;
            document.getElementById('tableTitle').innerHTML = `<i class="fas fa-bell"></i> ${t.tableTitle}`;
            document.getElementById('quickAccessTitle').innerText = t.quickTitle;
            const navSpans = document.querySelectorAll('#sidebarMenu li a span');
            navSpans.forEach((span, idx) => { if(t.nav[idx]) span.innerText = t.nav[idx]; });
            const statLabels = document.querySelectorAll('.stat-label');
            statLabels.forEach((label, idx) => { if(t.statLabels[idx]) label.innerText = t.statLabels[idx]; });
            const quickSpans = document.querySelectorAll('.q-span');
            quickSpans.forEach((span, idx) => { if(t.quickBtns[idx]) span.innerText = t.quickBtns[idx]; });
            const ths = document.querySelectorAll('.t-col');
            ths.forEach((th, idx) => { if(t.th[idx]) th.innerText = t.th[idx]; });
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString(t.dateLocale, options);
            loadRegistrationsFromForm();
        }

        function toggleMode() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            localStorage.setItem('user-theme', newTheme);
        }

        function loadAcademyIdentity() {
            document.getElementById('mainName').innerText = localStorage.getItem('academyName') || "Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø£Ù…Ù„ ÙƒÙŠØ´";
            const logoData = localStorage.getItem('academyLogo');
            if (logoData) {
                document.getElementById('mainLogo').src = logoData;
                document.getElementById('mainLogo').style.display = 'block';
                document.getElementById('defaultIcon').style.display = 'none';
            }
        }

        function updateOfficialPlayersCount() {
            const dbName = "AmalGuichSystem";
            let request = indexedDB.open(dbName, 1);
            request.onsuccess = function(e) {
                let db = e.target.result;
                if (db.objectStoreNames.contains("players")) {
                    let store = db.transaction("players", "readonly").objectStore("players");
                    let countReq = store.count();
                    countReq.onsuccess = () => document.getElementById('playerCount').innerText = countReq.result;
                }
            };
        }

        function updateOfficialCoachesCount() {
            const dbName = "AcademyManagerDB";
            let request = indexedDB.open(dbName, 1);
            request.onsuccess = function(e) {
                let db = e.target.result;
                if (db.objectStoreNames.contains("coaches")) {
                    let store = db.transaction("coaches", "readonly").objectStore("coaches");
                    let countReq = store.count();
                    countReq.onsuccess = () => document.getElementById('coachCount').innerText = countReq.result;
                }
            };
        }

        function updateDebtFromEquipment() {
            const DB_NAME = "AcademyInventoryDB_V7";
            let request = indexedDB.open(DB_NAME, 7);
            request.onsuccess = function(e) {
                let db = e.target.result;
                if (db.objectStoreNames.contains("inventory")) {
                    let store = db.transaction("inventory", "readonly").objectStore("inventory");
                    let getAll = store.getAll();
                    getAll.onsuccess = function() {
                        let totalDebt = 0;
                        getAll.result.forEach(item => totalDebt += parseFloat(item.remaining) || 0);
                        document.getElementById('totalDebtDisplay').innerText = totalDebt.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + " DH";
                    };
                }
            };
        }

        function updateFinanceStats() {
            const DB_NAME = "AmalGuichSystem";
            let request = indexedDB.open(DB_NAME, 1);
            request.onsuccess = function(e) {
                let db = e.target.result;
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                let monthlyRevenue = 0, yearlyRevenue = 0, monthlyExpenses = 0;

                const calcRevenue = () => new Promise((resolve) => {
                    if (!db.objectStoreNames.contains("payments")) return resolve();
                    let store = db.transaction("payments", "readonly").objectStore("payments");
                    let getAll = store.getAll();
                    getAll.onsuccess = function() {
                        getAll.result.forEach(payment => {
                            let pDate = new Date(payment.date);
                            if (pDate.getFullYear() === currentYear) {
                                yearlyRevenue += parseFloat(payment.amount) || 0;
                                if (pDate.getMonth() === currentMonth) monthlyRevenue += parseFloat(payment.amount) || 0;
                            }
                        });
                        resolve();
                    };
                });

                const calcExpenses = () => new Promise((resolve) => {
                    if (!db.objectStoreNames.contains("expenses")) return resolve();
                    let store = db.transaction("expenses", "readonly").objectStore("expenses");
                    let getAll = store.getAll();
                    getAll.onsuccess = function() {
                        getAll.result.forEach(exp => {
                            let d = new Date(exp.date);
                            if (d.getMonth() === currentMonth && d.getFullYear() === currentYear) monthlyExpenses += parseFloat(exp.amount) || 0;
                        });
                        resolve();
                    };
                });

                Promise.all([calcRevenue(), calcExpenses()]).then(() => {
                    const net = monthlyRevenue - monthlyExpenses;
                    document.getElementById('monthlyProfit').innerText = monthlyRevenue.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + " DH";
                    document.getElementById('yearlyProfit').innerText = yearlyRevenue.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + " DH";
                    document.getElementById('monthlyExpenses').innerText = monthlyExpenses.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + " DH";
                    const netEl = document.getElementById('netProfit');
                    netEl.innerText = net.toLocaleString('fr-FR', { minimumFractionDigits: 2 }) + " DH";
                    netEl.style.color = net >= 0 ? "var(--success)" : "var(--danger)";
                });
            };
        }

        function loadRegistrationsFromForm() {
            const lang = localStorage.getItem('pref-lang') || 'ar';
            const t = translations[lang];
            const tableBody = document.getElementById('registrationsTable');
            const badge = document.getElementById('requestCountBadge');
            const statTotal = document.getElementById('totalRequests');
            let registrations = JSON.parse(localStorage.getItem('academy_full_db') || '[]');
            tableBody.innerHTML = "";
            badge.innerText = `${registrations.length} ${t.reqBadge}`;
            statTotal.innerText = registrations.length;
            if (registrations.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:30px; color:var(--text-muted)">${t.noRequests}</td></tr>`;
                return;
            }
            registrations.forEach((reg, index) => {
                tableBody.innerHTML += `<tr>
                    <td><img src="${reg.photo || 'https://via.placeholder.com/40'}" class="player-img-mini"></td>
                    <td style="font-weight:700">${reg.fullName}</td>
                    <td>${reg.birthDate || '---'}</td>
                    <td><span class="status-badge" style="background:rgba(37, 99, 235, 0.15); color:var(--secondary)">${reg.category}</span></td>
                    <td><a href="tel:${reg.parentPhone}" style="color:var(--success); text-decoration:none; font-weight:600"><i class="fas fa-phone-alt"></i> ${reg.parentPhone}</a></td>
                    <td>
                        <button onclick="approveReg(${index})" class="btn" style="background:var(--success); color:white;"><i class="fas fa-check"></i> ${t.btnApprove}</button>
                        <button onclick="deleteReg(${index})" class="btn" style="background:rgba(239, 68, 68, 0.1); color:var(--danger);"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`;
            });
        }

        function approveReg(index) {
            const lang = localStorage.getItem('pref-lang') || 'ar';
            if(confirm(translations[lang].confirmApprove)) {
                let registrations = JSON.parse(localStorage.getItem('academy_full_db') || '[]');
                registrations.splice(index, 1);
                localStorage.setItem('academy_full_db', JSON.stringify(registrations));
                loadRegistrationsFromForm();
            }
        }

        function deleteReg(index) {
            const lang = localStorage.getItem('pref-lang') || 'ar';
            if(confirm(translations[lang].confirmDelete)) {
                let registrations = JSON.parse(localStorage.getItem('academy_full_db') || '[]');
                registrations.splice(index, 1);
                localStorage.setItem('academy_full_db', JSON.stringify(registrations));
                loadRegistrationsFromForm();
            }
        }

        window.onload = () => {
            const savedTheme = localStorage.getItem('user-theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('themeIcon').className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            loadAcademyIdentity();
            const startLang = localStorage.getItem('pref-lang') || 'ar';
            changeLanguage(startLang);
            updateOfficialPlayersCount();
            updateOfficialCoachesCount();
            updateDebtFromEquipment();
            updateFinanceStats();
            setInterval(() => {
                updateOfficialPlayersCount();
                updateOfficialCoachesCount();
                updateDebtFromEquipment();
                updateFinanceStats();
            }, 10000);
        };

        (function addDynamicWatermark() {
            const watermark = document.createElement('div');
            watermark.id = 'dynamic-watermark';
            Object.assign(watermark.style, { position: 'fixed', top: '50%', left: '50%', transform: 'translate(-50%, -50%) rotate(-25deg)', width: '60vw', height: '60vw', backgroundRepeat: 'no-repeat', backgroundPosition: 'center', backgroundSize: 'contain', opacity: '0.03', pointerEvents: 'none', zIndex: '-1', filter: 'grayscale(100%)' });
            const logoData = localStorage.getItem('academyLogo');
            if (logoData) watermark.style.backgroundImage = `url('${logoData}')`;
            document.body.appendChild(watermark);
        })();
    </script>

    <script src="assets/js/identity.js"></script>
    <script>
      window.addEventListener("load", function () {
        if (typeof applyAcademyIdentity === "function") {
          applyAcademyIdentity();
        }
      });
    </script>
</body>
</html>
